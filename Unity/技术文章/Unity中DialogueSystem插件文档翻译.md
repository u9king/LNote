# Unity中DialogueSystem插件文档翻译

## Unity的对话系统

### 欢迎来到Unity的对话系统！

对话系统是Unity的一个分支对话系统。它不需要脚本即可编辑并且设计得方便程序员进行拓展。

Unity的对话系统会使你：

- 用逻辑分支编写交互式对话
- 展示对话用一个灵活，完整的定制化UI系统
- 定义问题/人物给玩家来完成
- 播放过长动画序列，例如相机片段和音频
- 保存和加载游戏，依据场景变化保存游戏数据
- 用本地化来用不同语言展示文本和播放动画序列
- 导入和导出从不同格式例如：artity:草稿、聊天映射器和CSV格式

### 在手册中

在本手册中包含下列内容：

- 开始——安装，升级，样例和快速开始
- 对话编辑器——如何编写内容
- 对话管理器——如何设置主要对话系统游戏对象
- 触发和交互——如何设置游戏内的交互
- 对话UIs——如何设置对话UIs
- 逻辑和Lua——如何定义条件和用变量工作
- 过场序列(Cutscene)–如何设计过场序列
- 问题——如何编写和执行问题
- 保存系统——如何保存和加载数据
- 本地化——如何添加语言本地化
- 脚本化——编程参考
- 导入和导出——如何导入和导出不同格式
- 第三方融合——如何用对话系统与别的资产相结合
- 教程——手把手知道一个通用任务（所有视频教程）
- 组件参考
- 快问快答
- 版本说明

### 如何获得帮助

我们在这里提供帮助！如何你被困扰或者有很多问题，无论何时请我们来获得支持在pixelcrushers.com或者访问 https://pixelcrushers.com.我们尽全力24小时回复邮件。如果你没有收到回复在24小时之内，请检查您的垃圾邮件。

## 开始

### 安装

提示：如果要从1.x版本升级，请先阅读从1.x升级中的重要指示。

Unity的对话系统需要Unity2018.4以上版本。再开始前，打开包管理器窗口接着导入Unity的对话系统。将会有以下文件夹添加到你的项目中：

- 插件(Plugins)→像素破碎机(Pixel Crushers)→对话系统(Dialogue System):这就是对话系统
- 插件(Plugins)→像素破碎机(Pixel Crushers)→通用(Common):像素破碎机产品的核心脚本

2D支持：如果你的项目用的是2D物理，参见使用2D物理支持。

#### 从1.X版本升级

如果你不需要从1.X版本升级，跳过这个部分到样例场景即可。（点击这里浏览视频版本）

如果你正在从1.X版本升级，你必须要根据以下步骤来执行：

1.备份你的项目

2.如果你的项目用的是Unity5.x，你必须把先把强制文本序列化（Force Text serialization first）

- 选择菜单下的编辑Edit→项目设置Project Settings→编辑者

- 接着改变项目序列化Asset Serialization到强制文本Force Text和版本控制到可见Meta文件

  1.如果你的项目包含在Unity4.x创建的资源，请阅读下面的注释

  2.删除完整的对话系统文件夹。（如果你正在使用Unity5.x，不要做这些知道你已经转换到强制文本序列化）

  - 如果你已经将任何第三方支持文件夹移出了 Dialogue System 文件夹，也请将它们删除。
  - 确保你的项目依然能够变异。如果你有一些额外的脚本是基于对话系统的，你应该把它们导出作为临时的Unity包，删除他们，接着在重新完成升级之后把他们导回来。

  3.从资源商店中导入对话系统给Unity2.x

  4.运行工具→像素破碎者→对话系统→工具→运行1x到2x升级

  注意：如果项目中有任何编译错误，将无法运行更新程序。解决编译错误后，菜单项应会变为可用。

  如果你有任何关于升级过程的问题，请联系我们。
#### 关于 Unity 4.x 资源的注意事项

  对话系统内部脚本参考(GUIDs:Globally Unique Identifiers也叫全局唯一标识符)变化从1.x到2.x.更新工具定位具有过时1.xGUID的资产，并将他们重定向到新的2.xGUID。Unity可以存储资源，泪如场景文件和对话数据库，通过二进制或者文本的形式。这个过程叫做序列化。升级工具必须临时转换资产到文本系列化来升级对话系统的GUIDs。如果你的项目包含资产是通过Unity4进行的二进制序列化，Unity并不会将他们转换成文本序列化。这不仅限于对话系统；这是Unity的32位与64位的限制。在这种情况下，你必须在Unity4中打开他们，将他们转换成文本序列化，导出作为资产，并且在更新之前导入这些资产到你的项目中。

#### 更新注意事项

2.x版本做了如下改动：

- Unity的对话系统转移到了Plugins文件夹中。
- 源代码现在直接在项目中，而不再作为预编译DLL的Unity包文件。
- 旧版的Unity GUI和UnityUI对话界面子界面已被弃用，取而代之的是更强大且灵活的标准UI子系统，旧系统依然可用，但不再显示在组件菜单或检视器面板的添加组件按钮中。
- 触发组件，例如对话除法器和任务除法器，已合并为一个更简单、更优化的对话系统除法器。旧组件依然受支持，但推荐使用的触发器组件是现在对话系统的触发器。

### 下一步

- 演示场景
- 概述
- 快速开始

### 演示场景

演示场景保存在插件→像素破碎者→对话系统→演示。运行它就能看见对话系统是如何工作的了。

URP/HDRP注释：如果你的项目用了URP或者HDRP，在运行对话系统职前下载并且导入相关的材料包。

#### 如何运行

- 用方向键或者WASD键可以移动
- 用鼠标观察场景
- 观察可交互的物体并且用空格键来与之交互
- 鼠标按下左键来进行射击
- 按下Escape键来打开暂停菜单

注释：如果您在现有的项目中使用对话系统，并且玩家穿过地板掉落，可能是因为演示项目使用了Unity默认物理设置。

#### 可以尝试的事项

你可以在场景中做下面这几件事情

- 获取发射代码(任务):与私人哈特交谈来获取任务。这涉及到找到下一间房间的密码以及和电脑交互。
- 敌人攻击(任务):在下一个房间与NPC对话来获取任务。这展示了如何设置基于击杀的任务。
- 切换场景:与门交互来切换场景。这展示了如何在切换场景时保持数据。
- 保存&加载游戏：使用暂停菜单来保存游戏。

下一个部分展示一个完整的对话系统工作。如果你想要直接跳转到使用你自己的内容，你可以直接跳到快速开始的部分。

### 概述 — Overview

对话系统包括下面这些部分:

- 对话数据库(Dialogue Database)：包括你的对话，任务和变量等。
- 对话编辑器(Dialogue Editor)：编辑对话数据库。你也可以导入和导出第三方格式。
- 对话管理器(Dialogue Manager)：在游戏运行时管理对话系统。提供了一个预制体Prefab。
- 对话UIs(Dialogue UIs)：展示对话可交互性，警告信息，任务日志等。
- 交互系统(InteractionSystem)：在游戏运行时的触发器例如开启对话。

#### 对话数据库(Dialogue Database)

一个对话数据库是一个资产文件包含你的对话，任务和用户自定义的变量。你将可以传统地使用对话编辑器来编辑他的信息，你也可以通过多种不同的格式。

对话数据库包含设计时的内容，即你在Unity编辑器中编辑的字段。在运行时，对话系统将对话数据库视为只读。它加载对话数据库字段到Lua中，在游戏运行时，值可以被修改。

#### 对话编辑器(Dialogue Editor)

用对话编辑器来编辑你的对话数据库并在播放模式下查看其运行时状态。更多关于对话编辑器的信息，详见对话编辑器。通过不同格式例如articy:draft和Chat Mapper，详见导入&导出。

#### 对话管理器(Dialogue Manager)

对话管理器是场景中一个游戏物体，用来协调所有对话系统的活动，并持有对话系统运行时的数据。对话系统管理部分会详细说明这部分的内容。

#### 对话UIs(Dialogue UIs)

对话系统采用如下UIs

- 对话UI：运行交互对话和提示信息.（例子展示如上）
- 任务日志窗口：显示玩家当前任务和已完成的任务。
- 任务追踪HUD(Heads-Up Display抬头显示器)：显示当前任务的追踪信息。

更多关于对话UIs的信息，参考对话UIs.更多关于任务UIs的信息，参考任务。

#### 交互系统(Interaction System)

对话系统提供组件来与游戏物体进行交互并执行诸如开启对话或更新任务等操作。

#### 本地化(Localization)

对话系统支持数据库内容和通用UI元素的本地化。更多信息，详见本地化。

#### 拓展对话系统(Extending the Dialogue System)

虽然对话系统的默认功能已经非常强大和灵活,但你也可以创建自己的逻辑函数、过场动画动作、UI类型等。这些内容在脚本编写中有详细介绍。

### 快速开始 — Quick Start

我们在这里为您提供帮助!如果你在任何环节遇到困难，请联系我们。

提示：如果你正在制作2D项目，参考开启2D物理支持。

(点击此处观看视频版本)

本章节将直接进入对话系统来创建和运行对话的过程。您将学习到:

- 创建一个对话数据库和编写对话。
- 设置对话管理器戏物体。
- 开启一系列对话。
- 与物体之间的交互。
- 在对话过程中禁止玩家控制

您可以在紧跟随本快速入门部分之后的章节中找到更详细的步骤。

步骤1：创建一个场景（文件 →新场景）

步骤2：抓取预制体(资源>插件>像素破碎者Pixel Crushers>对话系统>预制体>对话管理者Dialogue Manager)到场景中:

步骤3：这个游戏对象已经指向一个基本的对话UI，目前足够使用。但是我们需要创建一个对话数据库。检查该游戏对象。在“初始数据库”字段旁,点击“创建”：

步骤4：在为您的数据库指定名称后，再次检查对话管理器游戏对象。点击编辑按钮或者对话系统的logo横幅，将会打开对话编辑器窗口：

步骤5：点击对话页签。

- 点击“+”按钮来添加一个新的对话
- 右键点击在橘黄色的START按钮上来选择创建新的子节点(Create Child Node)。在检视窗口中，设置对话文字为“Hello”。确保设置的是对话文字字段,而不是别的字段例如标题(Title)。
  - 提示：你也可以双击节点来直接输入对话文字在节点上。
- 右键点击在灰色节点上"Hello"接着再次选择创建子节点。设置对话文本为"Goodbye"
- 灰色节点是NPC们说话的节点,而蓝色节点代表的是玩家。你的对话应该显示如下：

步骤6：创建一个空游戏物体给玩家(游戏物体→创建 空)接着创建一个立方体给NPC（游戏物体→3D 物体→立方体）重命名空游戏对象为“玩家”。重命名立方体为“NPC”接着设置它的位置到(0,0,0)，以便在游戏视图中可见。（在您自己的项目中，您将使用实际的角色代替。）

步骤7：检视这个NPC。添加一个对话系统触发器组件：

步骤8：点击添加行为并选择开启对话：

步骤9：从对话下拉菜单中选择您的对话，将“玩家”分配给“对话角色”字段，将“NPC”分配给“对话参与者”。

步骤10：最终，设置(Dialogue System Trigger组件中的)触发下拉菜单为在启动时(On Start)。这将告诉系统触发器在场景开始时执行其操作。

步骤11：现在运行你的第一个对话！对话系统将显示NPC的台词"Hello"，随后很快出现玩家的回应菜单，其中包含一个选项“Goodbye”。它使用的是基础标准对话UI，这是一个通用模板，您之后可以自定义外观，使其符合您的需求。

下一步，我们将会使用交互系统来开启一段对话。

步骤12：设置(Dialogue System Trigger组件中的)触发下拉框回被使用时(On Use)。这将会告诉系统触发器在接收到被使用的消息(On Use)时来执行其操作，通常由玩家的交互系统触发。

步骤13：添加一个可交互组件(Usable)。这将指示告诉玩家的交互组件该NPC是可交互的。

步骤14：检视玩家和添加一个选择器组件(Selector)。将选择在下拉菜单(Select At)设置为鼠标位置。

步骤15：现在重新运行场景。把你的鼠标放到方块上，你就能看到黄色的信息(NPC spacebar to interact)

这意味着玩家的选择器组件(Selector)已经检测到NPC的可交互组件(Usable)。按下空格按钮或者鼠标右键。选择器组件(Selector)将会发送交互信息给NPC，使得NPC的对话系统触发器将响应并开始对话。

选择器组件(Selector)和一个类似的组件，叫做接近选择器(Proximity Selector)，提供了触发对话系统活动的方法。他们非常好自定义。你可以配置它们以不同的方式来选择可交互物品，而不仅仅是通过鼠标指针。使用它们也不是强制的。如果你想，你可以用自己的交互系统或者C#代码来运行对话系统触发器。

步骤16：你可能注意到，选择器组件(Selector)在对话期间保持激活状态。在很多情况下，在对话期间你可能需要禁用选择器组件(Selector)，并且可能还需要禁用其他组件,例如玩家移动和相机控制。有一个方法就是添加对话系统事件组件(Dialogue System Events)。这个组件有运行在各种对话系统活动中触发的事件。配置在对话开启的时候禁用选择器组件(Selector)，而在对话结束的时候重新开启它。

#### 快速开始总结

本快速开始展示了如何：

- 创建对话数据库并且编写对话内容
- 设置对话管理器游戏对象
- 开启对话
- 与对象交互
- 在对话期间禁用玩家控制

对话系统还有更多功能。继续阅读以获取更多信息。如果有任何问题或需要帮助，请练习我们。

### 对话编辑器 — Dialogue Editor

本章介绍如何使用对话编辑器来编写对话和任务。要导入和导出其他的格式，详见《导入&导出》

#### 对话数据库(Dialogue Database)

对话数据库是一个资产文件。要创建对话数据库：

- 点击对话管理器的创建按钮（如果尚未分配对话数据库）
- 或者选择资产**→** 创建→像素破碎者→对话系统→对话数据库。

一个对话数据库包含以下类别：

|    类别    | 描述                                                         |
| :--------: | :----------------------------------------------------------- |
| 数据库属性 | 一些通用设置，如描述、作者和版本信息，以及数据库范围的操作。 |
|   参与者   | 对话参与者(玩家、NPC、可互动对象)                            |
| 物品/任务  | 物品和任务的定义（物品是可选的数据记录，可供使用）           |
|    地点    | 有关地点的信息（可选的数据记录，可供使用）                   |
|    变量    | 用户定义的变量，用于跟踪对话决策等。                         |
|    对话    | 参与者之间的对话内容。                                       |

下面的对话编辑器部分描述了在编辑内容时每个类别的具体作用。






